% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cluster-metrics.R
\name{as_tna}
\alias{as_tna}
\title{Convert cluster_summary to tna Objects}
\usage{
as_tna(x)
}
\arguments{
\item{x}{A \code{cluster_summary} object created by \code{\link{cluster_summary}}.
The cluster_summary should typically be created with \code{type = "tna"} to
ensure row-normalized transition probabilities. If created with
\code{type = "raw"}, the raw counts will be passed to \code{tna::tna()}
which will normalize them.}
}
\value{
A \code{cluster_tna} object (S3 class) containing:
\describe{
\item{between}{A tna object representing cluster-level transitions.
Contains \code{$weights} (k x k transition matrix), \code{$inits}
(initial distribution), and \code{$labels} (cluster names).
Use this for analyzing how learners/entities move between high-level
groups or phases.}
\item{within}{Named list of tna objects, one per cluster. Each tna object
represents internal transitions within that cluster. Contains
\code{$weights} (n_i x n_i matrix), \code{$inits} (initial distribution),
and \code{$labels} (node labels). Clusters with single nodes or zero-row
nodes are excluded (tna requires positive row sums).}
}
}
\description{
Converts a \code{cluster_summary} object to proper tna objects that can be
used with all functions from the tna package. Creates both a between-cluster
tna model (cluster-level transitions) and within-cluster tna models (internal
transitions within each cluster).
}
\details{
This is the final step in the MCML workflow, enabling full integration with
the tna package for centrality analysis, bootstrap validation, permutation
tests, and visualization.
\subsection{Requirements}{

The tna package must be installed. If not available, the function throws
an error with installation instructions.
}

\subsection{Workflow}{

\preformatted{
# Full MCML workflow
net <- cograph(edges, nodes = nodes)
net$nodes$clusters <- group_assignments
cs <- cluster_summary(net, type = "tna")
tna_models <- as_tna(cs)

# Now use tna package functions
plot(tna_models$between)
tna::centrality(tna_models$between)
tna::bootstrap(tna_models$between, R = 1000)

# Analyze within-cluster patterns
plot(tna_models$within$ClusterA)
tna::centrality(tna_models$within$ClusterA)
}
}

\subsection{Excluded Clusters}{

A within-cluster tna cannot be created when:
\itemize{
\item The cluster has only 1 node (no internal transitions possible)
\item Some nodes in the cluster have no outgoing edges (row sums to 0)
}

These clusters are silently excluded from \code{$within}. The between-cluster
model still includes all clusters.
}
}
\examples{
# -----------------------------------------------------
# Basic usage
# -----------------------------------------------------
mat <- matrix(runif(36), 6, 6)
diag(mat) <- 0
rownames(mat) <- colnames(mat) <- LETTERS[1:6]

clusters <- list(
  G1 = c("A", "B"),
  G2 = c("C", "D"),
  G3 = c("E", "F")
)

cs <- cluster_summary(mat, clusters, type = "tna")
tna_models <- as_tna(cs)

# Print summary
tna_models

# -----------------------------------------------------
# Access components
# -----------------------------------------------------
# Between-cluster tna
tna_models$between
tna_models$between$weights  # 3x3 transition matrix
tna_models$between$inits    # Initial distribution
tna_models$between$labels   # c("G1", "G2", "G3")

# Within-cluster tnas
names(tna_models$within)    # Which clusters have within models
tna_models$within$G1        # tna for cluster G1
tna_models$within$G1$weights  # 2x2 matrix (A, B)

# -----------------------------------------------------
# Use with tna package (requires tna)
# -----------------------------------------------------
\dontrun{
# Plot
plot(tna_models$between)
plot(tna_models$within$G1)

# Centrality analysis
tna::centrality(tna_models$between)

# Bootstrap validation
boot <- tna::bootstrap(tna_models$between, R = 1000)
summary(boot)

# Compare clusters
tna::centrality(tna_models$within$G1)
tna::centrality(tna_models$within$G2)
}

# -----------------------------------------------------
# Check which within-cluster models were created
# -----------------------------------------------------
cs <- cluster_summary(mat, clusters, type = "tna")
tna_models <- as_tna(cs)

# All cluster names
names(cs$clusters)

# Clusters with valid within-models
names(tna_models$within)

# Clusters excluded (single node or zero rows)
setdiff(names(cs$clusters), names(tna_models$within))
}
\seealso{
\code{\link{cluster_summary}} to create the input object,
\code{\link{plot_mcml}} for visualization without conversion,
\code{tna::tna} for the underlying tna constructor
}
