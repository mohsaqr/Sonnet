<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Triad Persistence Analysis - cograph</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      background: #fafafa;
      color: #333;
      line-height: 1.6;
    }
    h1 {
      color: #800020;
      border-bottom: 3px solid #800020;
      padding-bottom: 10px;
    }
    h2 {
      color: #800020;
      margin-top: 40px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 8px;
    }
    h3 {
      color: #555;
      margin-top: 25px;
    }
    .section {
      background: white;
      border-radius: 8px;
      padding: 25px;
      margin: 25px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.08);
    }
    code {
      background: #f4f4f4;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: "SF Mono", Monaco, "Courier New", monospace;
      font-size: 0.9em;
    }
    pre {
      background: #2d2d2d;
      color: #f8f8f2;
      border-radius: 6px;
      padding: 18px;
      overflow-x: auto;
      font-family: "SF Mono", Monaco, "Courier New", monospace;
      font-size: 14px;
      line-height: 1.5;
    }
    pre .comment { color: #75715e; }
    pre .string { color: #e6db74; }
    pre .keyword { color: #f92672; }
    pre .function { color: #66d9ef; }
    pre .number { color: #ae81ff; }
    table {
      border-collapse: collapse;
      width: 100%;
      margin: 15px 0;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
    }
    th {
      background: #800020;
      color: white;
    }
    tr:nth-child(even) { background: #f9f9f9; }
    .note {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px;
      margin: 15px 0;
      border-radius: 0 6px 6px 0;
    }
    .tip {
      background: #d4edda;
      border-left: 4px solid #28a745;
      padding: 15px;
      margin: 15px 0;
      border-radius: 0 6px 6px 0;
    }
    ul { padding-left: 25px; }
    li { margin: 8px 0; }
  </style>
</head>
<body>

  <h1>Triad Persistence Analysis</h1>

  <p>
    Analyze how triadic structures persist, emerge, or fade across temporal windows in
    transition network analysis (TNA). This feature helps identify stable interaction
    patterns versus transient behaviors in sequential data.
  </p>

  <div class="section">
    <h2>Overview</h2>
    <p>
      The triad persistence analysis consists of two main functions:
    </p>
    <ul>
      <li><code>triad_persistence()</code> - Analyze triad/type persistence across time windows</li>
      <li><code>plot()</code> - Visualize results as heatmaps, timelines, or status charts</li>
    </ul>

    <h3>Key Features</h3>
    <ul>
      <li><strong>Density-based heatmaps</strong> - Color cells by actual transition counts, not just presence</li>
      <li><strong>Aggregation by type</strong> - View by specific triads or aggregate by MAN structural type</li>
      <li><strong>Edge weighting</strong> - Weight counts by triad edge density (cliques count more)</li>
      <li><strong>Normalization</strong> - Account for windows with different amounts of data</li>
      <li><strong>Status classification</strong> - Automatic labeling as persistent, transient, emerging, fading, or sporadic</li>
    </ul>
  </div>

  <div class="section">
    <h2>Basic Usage</h2>

    <pre><span class="keyword">library</span>(tna)
<span class="keyword">library</span>(cograph)

<span class="comment"># Extract temporal motifs from sequence data</span>
m &lt;- <span class="function">extract_motifs_temporal</span>(group_regulation,
                              window_size = <span class="number">5</span>,
                              step = <span class="number">2</span>,
                              pattern = <span class="string">"all"</span>)

<span class="comment"># Analyze triad persistence</span>
pers &lt;- <span class="function">triad_persistence</span>(m)

<span class="comment"># View summary</span>
<span class="function">print</span>(pers)

<span class="comment"># Plot heatmap</span>
<span class="function">plot</span>(pers, type = <span class="string">"heatmap"</span>)</pre>
  </div>

  <div class="section">
    <h2>Function Reference: triad_persistence()</h2>

    <h3>Parameters</h3>
    <table>
      <tr>
        <th>Parameter</th>
        <th>Default</th>
        <th>Description</th>
      </tr>
      <tr>
        <td><code>x</code></td>
        <td>-</td>
        <td>A <code>cograph_temporal_motifs</code> object from <code>extract_motifs_temporal()</code></td>
      </tr>
      <tr>
        <td><code>by</code></td>
        <td><code>"triad"</code></td>
        <td>
          Aggregation level:<br>
          <code>"triad"</code> - Track specific labeled triads (e.g., "Plan - Execute - Monitor")<br>
          <code>"type"</code> - Aggregate by MAN type (e.g., "021C", "300")
        </td>
      </tr>
      <tr>
        <td><code>edge_weight</code></td>
        <td><code>FALSE</code></td>
        <td>
          Weight counts by edge density. A full bidirectional clique (6 edges) gets 2x weight,
          while a minimal triad (3 edges) stays at 1x.<br>
          Formula: <code>count * (n_edges / 3)</code>
        </td>
      </tr>
      <tr>
        <td><code>min_windows</code></td>
        <td><code>1</code></td>
        <td>Minimum number of windows a triad/type must appear in to be included</td>
      </tr>
      <tr>
        <td><code>min_persistence</code></td>
        <td><code>0.5</code></td>
        <td>Minimum persistence score (0-1) to be classified as "persistent"</td>
      </tr>
    </table>

    <h3>Return Value</h3>
    <p>A <code>cograph_triad_persistence</code> object containing:</p>
    <table>
      <tr>
        <th>Field</th>
        <th>Description</th>
      </tr>
      <tr>
        <td><code>triads</code></td>
        <td>Data frame with triad/type label, MAN type, n_windows, first/last window, persistence score, total_count, status</td>
      </tr>
      <tr>
        <td><code>counts_matrix</code></td>
        <td>Numeric matrix (rows x windows) with actual observed counts per cell</td>
      </tr>
      <tr>
        <td><code>presence_matrix</code></td>
        <td>Binary matrix (0/1) showing presence/absence</td>
      </tr>
      <tr>
        <td><code>window_totals</code></td>
        <td>Total number of triads observed per window (for normalization)</td>
      </tr>
      <tr>
        <td><code>summary</code></td>
        <td>List with counts by status category</td>
      </tr>
      <tr>
        <td><code>params</code></td>
        <td>List of parameters used (including <code>by</code>)</td>
      </tr>
    </table>
  </div>

  <div class="section">
    <h2>Function Reference: plot()</h2>

    <h3>Parameters</h3>
    <table>
      <tr>
        <th>Parameter</th>
        <th>Default</th>
        <th>Description</th>
      </tr>
      <tr>
        <td><code>x</code></td>
        <td>-</td>
        <td>A <code>cograph_triad_persistence</code> object</td>
      </tr>
      <tr>
        <td><code>type</code></td>
        <td><code>"heatmap"</code></td>
        <td>
          Plot type:<br>
          <code>"heatmap"</code> - Presence/density across windows<br>
          <code>"timeline"</code> - First/last appearance timeline<br>
          <code>"status"</code> - Status distribution bar chart
        </td>
      </tr>
      <tr>
        <td><code>top_n</code></td>
        <td><code>NULL</code></td>
        <td>Maximum triads to display. <code>NULL</code> shows all triads</td>
      </tr>
      <tr>
        <td><code>fill</code></td>
        <td><code>"density"</code></td>
        <td>
          <code>"density"</code> - Color by count (globally normalized)<br>
          <code>"binary"</code> - Simple present/absent coloring
        </td>
      </tr>
      <tr>
        <td><code>normalize</code></td>
        <td><code>FALSE</code></td>
        <td>Normalize by window totals (shows % of all triads in each window)</td>
      </tr>
      <tr>
        <td><code>show_counts</code></td>
        <td><code>NULL</code></td>
        <td>Display count values in cells. Auto-enabled for small matrices (&lt;200 cells)</td>
      </tr>
    </table>
  </div>

  <div class="section">
    <h2>Aggregation: by = "triad" vs "type"</h2>

    <div class="note">
      <strong>Understanding the difference:</strong> With <code>by = "triad"</code>, each specific
      three-node combination (e.g., "Plan - Execute - Monitor") can only appear 0 or 1 time per window.
      With <code>by = "type"</code>, you see how many triads of each structural pattern exist,
      giving meaningful count variation.
    </div>

    <h3>By Specific Triads (default)</h3>
    <pre><span class="comment"># Track specific labeled triads</span>
pers &lt;- <span class="function">triad_persistence</span>(m, by = <span class="string">"triad"</span>)
<span class="function">plot</span>(pers, type = <span class="string">"heatmap"</span>, top_n = <span class="number">20</span>)</pre>
    <p>Each row is a unique three-node combination. Counts are 0 or 1.</p>

    <h3>By MAN Type</h3>
    <pre><span class="comment"># Aggregate by structural type (300, 210, 120D, etc.)</span>
pers_type &lt;- <span class="function">triad_persistence</span>(m, by = <span class="string">"type"</span>)
<span class="function">plot</span>(pers_type, type = <span class="string">"heatmap"</span>, show_counts = <span class="keyword">TRUE</span>)</pre>
    <p>Each row is a MAN type. Counts show how many triads of that structural pattern exist per window.</p>
  </div>

  <div class="section">
    <h2>Edge Weighting</h2>

    <p>
      Weight counts by the structural density of each triad. More connected triads
      (with mutual/bidirectional edges) get higher weights.
    </p>

    <pre><span class="comment"># Weight by edge density</span>
<span class="comment"># Full clique (6 edges) = 2x, minimal triad (3 edges) = 1x</span>
pers_w &lt;- <span class="function">triad_persistence</span>(m, by = <span class="string">"triad"</span>, edge_weight = <span class="keyword">TRUE</span>)
<span class="function">plot</span>(pers_w, type = <span class="string">"heatmap"</span>, top_n = <span class="number">20</span>, show_counts = <span class="keyword">TRUE</span>)</pre>

    <table>
      <tr>
        <th>Triad Type</th>
        <th>Edges</th>
        <th>Weight Multiplier</th>
      </tr>
      <tr>
        <td>Minimal (3 asymmetric edges)</td>
        <td>3</td>
        <td>1.0x</td>
      </tr>
      <tr>
        <td>One mutual pair</td>
        <td>4</td>
        <td>1.33x</td>
      </tr>
      <tr>
        <td>Two mutual pairs</td>
        <td>5</td>
        <td>1.67x</td>
      </tr>
      <tr>
        <td>Full clique (all mutual)</td>
        <td>6</td>
        <td>2.0x</td>
      </tr>
    </table>
  </div>

  <div class="section">
    <h2>Normalization</h2>

    <p>
      When windows have different amounts of data, normalization helps compare fairly.
      The <code>normalize = TRUE</code> option divides each cell by the total triads in that window.
    </p>

    <pre><span class="comment"># Raw counts</span>
<span class="function">plot</span>(pers_type, type = <span class="string">"heatmap"</span>)

<span class="comment"># Normalized by window totals (as percentage)</span>
<span class="function">plot</span>(pers_type, type = <span class="string">"heatmap"</span>, normalize = <span class="keyword">TRUE</span>)</pre>

    <div class="tip">
      <strong>Tip:</strong> Use normalization when comparing windows with very different
      sample sizes or when analyzing proportional changes over time.
    </div>
  </div>

  <div class="section">
    <h2>Status Classification</h2>

    <p>Triads are automatically classified based on their appearance pattern:</p>

    <table>
      <tr>
        <th>Status</th>
        <th>Definition</th>
      </tr>
      <tr>
        <td><strong>Persistent</strong></td>
        <td>Appears in at least <code>min_persistence</code> proportion of windows (default 50%)</td>
      </tr>
      <tr>
        <td><strong>Transient</strong></td>
        <td>Appears in only 1 window</td>
      </tr>
      <tr>
        <td><strong>Emerging</strong></td>
        <td>First appears after window 1 AND last appears in final window</td>
      </tr>
      <tr>
        <td><strong>Fading</strong></td>
        <td>First appears in window 1 AND disappears before final window</td>
      </tr>
      <tr>
        <td><strong>Sporadic</strong></td>
        <td>Other patterns (gaps in appearance)</td>
      </tr>
    </table>

    <pre><span class="comment"># View status distribution</span>
<span class="function">plot</span>(pers, type = <span class="string">"status"</span>)

<span class="comment"># Filter by status</span>
persistent_triads &lt;- pers$triads[pers$triads$status == <span class="string">"persistent"</span>, ]</pre>
  </div>

  <div class="section">
    <h2>Accessing the Data</h2>

    <pre><span class="comment"># Access counts matrix (actual observed counts)</span>
pers$counts_matrix[<span class="number">1</span>:<span class="number">5</span>, <span class="number">1</span>:<span class="number">5</span>]

<span class="comment"># Access binary presence matrix</span>
pers$presence_matrix[<span class="number">1</span>:<span class="number">5</span>, <span class="number">1</span>:<span class="number">5</span>]

<span class="comment"># Access window totals (for normalization)</span>
pers$window_totals

<span class="comment"># Get max count in the matrix</span>
<span class="function">max</span>(pers$counts_matrix)

<span class="comment"># Manual normalization: percentage of all triads in each window</span>
normalized_mat &lt;- <span class="function">sweep</span>(pers$counts_matrix, <span class="number">2</span>, pers$window_totals, <span class="string">"/"</span>)
<span class="function">round</span>(normalized_mat * <span class="number">100</span>, <span class="number">1</span>)  <span class="comment"># As percentages</span></pre>
  </div>

  <div class="section">
    <h2>Complete Example</h2>

    <pre><span class="keyword">library</span>(tna)
<span class="keyword">library</span>(cograph)

<span class="comment"># Load data and extract temporal motifs</span>
data &lt;- group_regulation
m &lt;- <span class="function">extract_motifs_temporal</span>(data, window_size = <span class="number">5</span>, step = <span class="number">2</span>, pattern = <span class="string">"all"</span>)

<span class="comment"># ---- By specific triads ----</span>
pers &lt;- <span class="function">triad_persistence</span>(m)
<span class="function">print</span>(pers)
<span class="function">plot</span>(pers, type = <span class="string">"heatmap"</span>, top_n = <span class="number">20</span>)

<span class="comment"># ---- By MAN type ----</span>
pers_type &lt;- <span class="function">triad_persistence</span>(m, by = <span class="string">"type"</span>)
<span class="function">plot</span>(pers_type, type = <span class="string">"heatmap"</span>, show_counts = <span class="keyword">TRUE</span>)
<span class="function">plot</span>(pers_type, type = <span class="string">"heatmap"</span>, normalize = <span class="keyword">TRUE</span>, show_counts = <span class="keyword">TRUE</span>)

<span class="comment"># ---- With edge weighting ----</span>
pers_weighted &lt;- <span class="function">triad_persistence</span>(m, by = <span class="string">"triad"</span>, edge_weight = <span class="keyword">TRUE</span>)
<span class="function">plot</span>(pers_weighted, type = <span class="string">"heatmap"</span>, top_n = <span class="number">20</span>, show_counts = <span class="keyword">TRUE</span>)

<span class="comment"># ---- Other plot types ----</span>
<span class="function">plot</span>(pers, type = <span class="string">"timeline"</span>, top_n = <span class="number">20</span>)
<span class="function">plot</span>(pers, type = <span class="string">"status"</span>)

<span class="comment"># ---- Binary fill (simple present/absent) ----</span>
<span class="function">plot</span>(pers, type = <span class="string">"heatmap"</span>, fill = <span class="string">"binary"</span>, top_n = <span class="number">20</span>)</pre>
  </div>

  <div class="section">
    <h2>See Also</h2>
    <ul>
      <li><code>extract_motifs_temporal()</code> - Extract motifs across time windows</li>
      <li><code>extract_motifs()</code> - Single network motif extraction</li>
      <li><code>plot.cograph_motif_analysis()</code> - Plot motif analysis results</li>
    </ul>
  </div>

  <footer style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; color: #666; font-size: 14px;">
    <p>cograph package - Network visualization for R</p>
  </footer>

</body>
</html>
