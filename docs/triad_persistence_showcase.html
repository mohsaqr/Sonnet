<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triad Persistence Analysis - Showcase</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
            color: #333;
        }
        h1 {
            color: #800020;
            border-bottom: 3px solid #800020;
            padding-bottom: 10px;
        }
        h2 {
            color: #2E7D32;
            margin-top: 40px;
        }
        h3 {
            color: #555;
        }
        .example {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .plot-container {
            text-align: center;
            margin: 20px 0;
        }
        .plot-container img {
            max-width: 100%;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        code {
            background: #e8e8e8;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'SF Mono', Monaco, 'Courier New', monospace;
        }
        pre {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
        }
        pre code {
            background: transparent;
            color: inherit;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 2px;
        }
        .persistent { background: #800020; color: white; }
        .transient { background: #999; color: white; }
        .emerging { background: #2E7D32; color: white; }
        .fading { background: #C62828; color: white; }
        .sporadic { background: #E69F00; color: white; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #f0f0f0;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
    </style>
</head>
<body>
    <h1>ðŸ”º Triad Persistence Analysis</h1>

    <p>The <code>triad_persistence()</code> function tracks <strong>specific labeled triads</strong> across temporal windows,
    identifying which node combinations persist, emerge, or disappear over time.</p>

    <div class="example">
        <h2>Status Classification</h2>
        <p>Each triad is classified based on its temporal pattern:</p>
        <p>
            <span class="status-badge persistent">Persistent</span> Appears in â‰¥50% of windows<br>
            <span class="status-badge transient">Transient</span> Appears in only 1 window<br>
            <span class="status-badge emerging">Emerging</span> First appears after window 1, persists to final window<br>
            <span class="status-badge fading">Fading</span> Present from window 1, disappears before final window<br>
            <span class="status-badge sporadic">Sporadic</span> Other patterns (gaps in appearance)
        </p>
    </div>

    <h2>Example 1: Synthetic Data with Temporal Change</h2>
    <div class="example">
        <h3>Data Setup</h3>
        <p>Synthetic data with 50 persons over 20 timepoints, where dominant states change over time:</p>
        <ul>
            <li><strong>Early (T1-T7):</strong> States A, B, C dominant</li>
            <li><strong>Middle (T8-T14):</strong> States B, C, D dominant</li>
            <li><strong>Late (T15-T20):</strong> States C, D, E dominant</li>
        </ul>

        <pre><code># Extract temporal motifs
m <- extract_motifs_temporal(wide_data, window_size = 5, step = 2, pattern = "triangle")

# Analyze persistence
pers <- triad_persistence(m)
print(pers)</code></pre>

        <h3>Results</h3>
        <table>
            <tr><th>Triad</th><th>Type</th><th>Persistence</th><th>Windows</th><th>Status</th></tr>
            <tr><td>B - C - D</td><td>300</td><td>62.5%</td><td>3,4,5,6,7</td><td><span class="status-badge persistent">Persistent</span></td></tr>
            <tr><td>A - B - C</td><td>300</td><td>50.0%</td><td>1,2,3,4</td><td><span class="status-badge persistent">Persistent</span></td></tr>
            <tr><td>C - D - E</td><td>300</td><td>37.5%</td><td>6,7,8</td><td><span class="status-badge emerging">Emerging</span></td></tr>
            <tr><td>A - B - D</td><td>120D</td><td>25.0%</td><td>3,4</td><td><span class="status-badge sporadic">Sporadic</span></td></tr>
            <tr><td>A - C - D</td><td>120D</td><td>25.0%</td><td>3,4</td><td><span class="status-badge sporadic">Sporadic</span></td></tr>
            <tr><td>B - C - E</td><td>120U</td><td>25.0%</td><td>6,7</td><td><span class="status-badge sporadic">Sporadic</span></td></tr>
            <tr><td>B - D - E</td><td>120U</td><td>25.0%</td><td>6,7</td><td><span class="status-badge sporadic">Sporadic</span></td></tr>
        </table>
    </div>

    <div class="grid">
        <div class="plot-container">
            <h3>Heatmap: Presence/Absence</h3>
            <img src="variation_heatmap.png" alt="Persistence Heatmap">
        </div>
        <div class="plot-container">
            <h3>Timeline: Lifespan</h3>
            <img src="variation_timeline.png" alt="Timeline">
        </div>
    </div>

    <div class="plot-container">
        <h3>Status Distribution</h3>
        <img src="variation_status.png" alt="Status Distribution" style="max-width: 500px;">
    </div>

    <h2>Example 2: Stable Patterns (group_regulation)</h2>
    <div class="example">
        <h3>Real Data: Self-Regulated Learning</h3>
        <p>The <code>group_regulation</code> dataset from the tna package shows remarkably stable triadic patterns -
        all 84 triads persist across all 6 time windows (100% persistence).</p>

        <pre><code>library(tna)
data <- group_regulation

# Extract temporal motifs
m <- extract_motifs_temporal(data, window_size = 5, step = 2, pattern = "all")

# All triads are persistent!
pers <- triad_persistence(m)
# Windows: 6 | Triads tracked: 84
# Persistent: 84 | Transient: 0 | Emerging: 0 | Fading: 0</code></pre>
    </div>

    <div class="grid">
        <div class="plot-container">
            <h3>Heatmap (Top 20 Triads)</h3>
            <img src="example1_heatmap.png" alt="group_regulation Heatmap">
        </div>
        <div class="plot-container">
            <h3>Timeline</h3>
            <img src="example1_timeline.png" alt="group_regulation Timeline">
        </div>
    </div>

    <h2>Example 3: More Windows, Same Data</h2>
    <div class="example">
        <p>Using smaller windows (size=3, step=1) creates 13 windows for finer temporal resolution:</p>

        <pre><code>m2 <- extract_motifs_temporal(data, window_size = 3, step = 1, pattern = "triangle")
pers2 <- triad_persistence(m2)
# Windows: 13 | Still all 84 triads persistent!</code></pre>
    </div>

    <div class="plot-container">
        <h3>Heatmap with 13 Windows</h3>
        <img src="example2_heatmap.png" alt="13-window Heatmap">
    </div>

    <h2>Usage Reference</h2>
    <div class="example">
        <h3>Basic Usage</h3>
        <pre><code>library(cograph)
library(tna)

# Step 1: Extract temporal motifs
m <- extract_motifs_temporal(data, window_size = 5, step = 2, pattern = "triangle")

# Step 2: Analyze triad persistence
pers <- triad_persistence(m)

# Step 3: View results
print(pers)              # Summary
pers$triads              # Full data frame
pers$presence_matrix     # Binary presence matrix
pers$summary             # Status counts</code></pre>

        <h3>Visualization Options</h3>
        <pre><code># Heatmap: presence/absence across windows
plot(pers, type = "heatmap", top_n = 20)

# Timeline: first/last appearance with status coloring
plot(pers, type = "timeline", top_n = 20)

# Bar chart: status distribution
plot(pers, type = "status")</code></pre>

        <h3>Filtering Options</h3>
        <pre><code># Only triads appearing in 5+ windows
pers_filtered <- triad_persistence(m, min_windows = 5)

# Only highly persistent triads (70%+)
pers_persistent <- triad_persistence(m, min_persistence = 0.7)

# Filter by status
emerging <- pers$triads[pers$triads$status == "emerging", ]
fading <- pers$triads[pers$triads$status == "fading", ]</code></pre>
    </div>

    <h2>Combined Visualization</h2>
    <div class="plot-container">
        <img src="example6_combined.png" alt="Combined visualization">
    </div>

    <div class="example">
        <h3>Interpretation Guide</h3>
        <ul>
            <li><strong>Persistent triads</strong> indicate stable relationship patterns that endure across time</li>
            <li><strong>Emerging triads</strong> suggest new patterns forming later in the observation period</li>
            <li><strong>Fading triads</strong> indicate patterns that were present early but disappeared</li>
            <li><strong>Sporadic triads</strong> appear intermittently, possibly indicating unstable or context-dependent patterns</li>
            <li><strong>Transient triads</strong> appear only once, potentially representing noise or unique events</li>
        </ul>
    </div>

    <footer style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; color: #666; text-align: center;">
        <p>cograph Package - Triad Persistence Analysis</p>
        <p><code>triad_persistence()</code> | <code>plot.cograph_triad_persistence()</code></p>
    </footer>
</body>
</html>
