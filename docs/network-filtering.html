<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Network Filtering - cograph Package</title>
  <style>
    :root {
      --primary: #7c3aed;
      --primary-dark: #6d28d9;
      --secondary: #64748b;
      --success: #16a34a;
      --warning: #ea580c;
      --danger: #dc2626;
      --bg: #f8fafc;
      --card-bg: #ffffff;
      --text: #1e293b;
      --text-muted: #64748b;
      --border: #e2e8f0;
      --code-bg: #1e293b;
      --code-text: #e2e8f0;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      padding: 0;
    }

    .header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 3rem 2rem;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }

    .header .subtitle {
      font-size: 1.2rem;
      opacity: 0.9;
    }

    .header .version {
      display: inline-block;
      background: rgba(255,255,255,0.2);
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
      margin-top: 1rem;
      font-size: 0.9rem;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    .toc {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 1.5rem 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .toc h2 {
      font-size: 1.2rem;
      margin-bottom: 1rem;
      color: var(--secondary);
    }

    .toc ul {
      list-style: none;
      columns: 2;
      gap: 2rem;
    }

    .toc li {
      margin-bottom: 0.5rem;
    }

    .toc a {
      color: var(--primary);
      text-decoration: none;
    }

    .toc a:hover {
      text-decoration: underline;
    }

    .section {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .section h2 {
      color: var(--primary);
      font-size: 1.5rem;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--border);
    }

    .section h3 {
      color: var(--text);
      font-size: 1.2rem;
      margin: 1.5rem 0 0.75rem 0;
    }

    .section p {
      margin-bottom: 1rem;
      color: var(--text);
    }

    pre {
      background: var(--code-bg);
      color: var(--code-text);
      padding: 1.25rem;
      border-radius: 8px;
      overflow-x: auto;
      margin: 1rem 0;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 0.9rem;
      line-height: 1.5;
    }

    code {
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 0.9em;
    }

    p code, li code {
      background: #f1f5f9;
      padding: 0.2rem 0.4rem;
      border-radius: 4px;
      color: var(--primary-dark);
    }

    .func-table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
    }

    .func-table th,
    .func-table td {
      padding: 0.75rem 1rem;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    .func-table th {
      background: var(--bg);
      font-weight: 600;
      color: var(--secondary);
    }

    .func-table tr:hover {
      background: var(--bg);
    }

    .func-name {
      font-family: monospace;
      color: var(--primary);
      font-weight: 600;
    }

    .badge {
      display: inline-block;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .badge-primary {
      background: #ede9fe;
      color: var(--primary);
    }

    .badge-success {
      background: #dcfce7;
      color: var(--success);
    }

    .badge-warning {
      background: #ffedd5;
      color: var(--warning);
    }

    .tip {
      background: #f0fdf4;
      border-left: 4px solid var(--success);
      padding: 1rem 1.25rem;
      margin: 1rem 0;
      border-radius: 0 8px 8px 0;
    }

    .tip-title {
      font-weight: 600;
      color: var(--success);
      margin-bottom: 0.25rem;
    }

    .warning {
      background: #fffbeb;
      border-left: 4px solid var(--warning);
      padding: 1rem 1.25rem;
      margin: 1rem 0;
      border-radius: 0 8px 8px 0;
    }

    .warning-title {
      font-weight: 600;
      color: var(--warning);
      margin-bottom: 0.25rem;
    }

    .info {
      background: #eff6ff;
      border-left: 4px solid #3b82f6;
      padding: 1rem 1.25rem;
      margin: 1rem 0;
      border-radius: 0 8px 8px 0;
    }

    .info-title {
      font-weight: 600;
      color: #3b82f6;
      margin-bottom: 0.25rem;
    }

    ul, ol {
      margin: 1rem 0;
      padding-left: 1.5rem;
    }

    li {
      margin-bottom: 0.5rem;
    }

    .two-col {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }

    @media (max-width: 768px) {
      .two-col {
        grid-template-columns: 1fr;
      }
      .toc ul {
        columns: 1;
      }
    }

    .comment {
      color: #6b7280;
    }

    .string {
      color: #10b981;
    }

    .keyword {
      color: #f472b6;
    }

    .number {
      color: #fbbf24;
    }
  </style>
</head>
<body>

<div class="header">
  <h1>Network Filtering</h1>
  <div class="subtitle">dplyr-style filtering for nodes and edges in cograph</div>
  <div class="version">cograph 1.5.2</div>
</div>

<div class="container">

  <nav class="toc">
    <h2>Contents</h2>
    <ul>
      <li><a href="#overview">Overview</a></li>
      <li><a href="#filter-edges">filter_edges()</a></li>
      <li><a href="#filter-nodes">filter_nodes()</a></li>
      <li><a href="#available-variables">Available Variables</a></li>
      <li><a href="#keep-format">Format Preservation</a></li>
      <li><a href="#chaining">Pipe Chaining</a></li>
      <li><a href="#examples">Complete Examples</a></li>
    </ul>
  </nav>

  <!-- Overview -->
  <section class="section" id="overview">
    <h2>Overview</h2>
    <p>
      cograph provides powerful, intuitive filtering functions that use dplyr-style syntax
      to filter networks by node metadata, centrality measures, or edge attributes.
    </p>

    <table class="func-table">
      <thead>
        <tr>
          <th>Function</th>
          <th>Description</th>
          <th>Alias</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="func-name">filter_nodes()</td>
          <td>Filter nodes by any column or centrality measure</td>
          <td><code>subset_nodes()</code></td>
        </tr>
        <tr>
          <td class="func-name">filter_edges()</td>
          <td>Filter edges by any edge attribute</td>
          <td><code>subset_edges()</code></td>
        </tr>
      </tbody>
    </table>

    <div class="tip">
      <div class="tip-title">Key Features</div>
      <ul>
        <li>Multiple filter conditions with <code>...</code> syntax</li>
        <li>Access to ALL metadata columns (not just predefined ones)</li>
        <li>Automatic centrality computation for node filtering</li>
        <li>Pipe-friendly for chaining operations</li>
        <li>Optional format preservation with <code>keep_format = TRUE</code></li>
      </ul>
    </div>
  </section>

  <!-- filter_edges -->
  <section class="section" id="filter-edges">
    <h2>filter_edges()</h2>
    <p>Filter edges using expressions on any edge column.</p>

    <h3>Syntax</h3>
    <pre>filter_edges(x, ..., .keep_isolates = FALSE, keep_format = FALSE, directed = NULL)</pre>

    <h3>Parameters</h3>
    <table class="func-table">
      <tr>
        <td><code>x</code></td>
        <td>Network input: cograph_network, matrix, igraph, network, or tna object</td>
      </tr>
      <tr>
        <td><code>...</code></td>
        <td>Filter expressions (e.g., <code>weight > 0.5</code>)</td>
      </tr>
      <tr>
        <td><code>.keep_isolates</code></td>
        <td>Keep nodes with no edges? Default <code>FALSE</code></td>
      </tr>
      <tr>
        <td><code>keep_format</code></td>
        <td>Return same format as input? Default <code>FALSE</code></td>
      </tr>
    </table>

    <h3>Basic Examples</h3>
    <pre><span class="comment"># Create network</span>
adj <- matrix(c(0, .5, .8, 0,
                .5, 0, .3, .6,
                .8, .3, 0, .4,
                 0, .6, .4, 0), 4, 4, byrow = TRUE)
rownames(adj) <- colnames(adj) <- c(<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"C"</span>, <span class="string">"D"</span>)

<span class="comment"># Keep only strong edges</span>
filter_edges(adj, weight > <span class="number">0.5</span>)

<span class="comment"># Keep edges above mean weight</span>
filter_edges(adj, weight >= mean(weight))

<span class="comment"># Top 25% of edges</span>
filter_edges(adj, weight >= quantile(weight, <span class="number">0.75</span>))

<span class="comment"># Absolute value filter</span>
filter_edges(adj, abs(weight) > <span class="number">0.3</span>)</pre>

    <h3>Keep Isolated Nodes</h3>
    <pre><span class="comment"># By default, nodes with no remaining edges are removed</span>
filter_edges(adj, weight > <span class="number">0.7</span>)
<span class="comment">#> 2 nodes (only A-C edge remains)</span>

<span class="comment"># Keep all nodes even if they have no edges</span>
filter_edges(adj, weight > <span class="number">0.7</span>, .keep_isolates = TRUE)
<span class="comment">#> 4 nodes (B and D kept as isolates)</span></pre>
  </section>

  <!-- filter_nodes -->
  <section class="section" id="filter-nodes">
    <h2>filter_nodes()</h2>
    <p>Filter nodes using expressions on any node column or centrality measure.</p>

    <h3>Syntax</h3>
    <pre>filter_nodes(x, ..., .keep_edges = "internal", keep_format = FALSE, directed = NULL)</pre>

    <h3>Parameters</h3>
    <table class="func-table">
      <tr>
        <td><code>x</code></td>
        <td>Network input: cograph_network, matrix, igraph, network, or tna object</td>
      </tr>
      <tr>
        <td><code>...</code></td>
        <td>Filter expressions (e.g., <code>degree >= 3</code>, <code>label == "A"</code>)</td>
      </tr>
      <tr>
        <td><code>.keep_edges</code></td>
        <td><code>"internal"</code> (keep edges between remaining nodes) or <code>"none"</code></td>
      </tr>
      <tr>
        <td><code>keep_format</code></td>
        <td>Return same format as input? Default <code>FALSE</code></td>
      </tr>
    </table>

    <h3>Filter by Centrality</h3>
    <pre><span class="comment"># High-degree nodes</span>
filter_nodes(adj, degree >= <span class="number">3</span>)

<span class="comment"># High PageRank</span>
filter_nodes(adj, pagerank > <span class="number">0.2</span>)

<span class="comment"># Multiple centrality conditions</span>
filter_nodes(adj, betweenness > <span class="number">0</span> & degree >= <span class="number">2</span>)

<span class="comment"># Hub nodes (high outgoing influence)</span>
filter_nodes(adj, hub > <span class="number">0.5</span>)</pre>

    <h3>Filter by Metadata</h3>
    <pre><span class="comment"># By label</span>
filter_nodes(adj, label %in% c(<span class="string">"A"</span>, <span class="string">"C"</span>))

<span class="comment"># Exclude specific nodes</span>
filter_nodes(adj, label != <span class="string">"D"</span>)

<span class="comment"># Combined: centrality + metadata</span>
filter_nodes(adj, degree >= <span class="number">2</span> & label != <span class="string">"D"</span>)</pre>

    <h3>TNA Networks</h3>
    <pre><span class="comment"># Filter by initial state probabilities</span>
tna_net <- as_cograph(tna_model)
filter_nodes(tna_net, inits > <span class="number">0.1</span>)

<span class="comment"># Filter by color (from TNA states)</span>
filter_nodes(tna_net, color == <span class="string">"#FF0000"</span>)</pre>
  </section>

  <!-- Available Variables -->
  <section class="section" id="available-variables">
    <h2>Available Variables</h2>

    <div class="two-col">
      <div>
        <h3>For filter_nodes()</h3>
        <p><strong>Node Columns:</strong></p>
        <ul>
          <li><code>id</code> - Node index</li>
          <li><code>label</code> - Node label/name</li>
          <li><code>name</code> - Alternative name</li>
          <li><code>x</code>, <code>y</code> - Layout coordinates</li>
          <li><code>inits</code> - Initial probabilities (TNA)</li>
          <li><code>color</code> - Node color</li>
          <li>+ any custom columns</li>
        </ul>

        <p><strong>Centrality Measures:</strong></p>
        <ul>
          <li><code>degree</code>, <code>indegree</code>, <code>outdegree</code></li>
          <li><code>strength</code>, <code>instrength</code>, <code>outstrength</code></li>
          <li><code>betweenness</code>, <code>closeness</code></li>
          <li><code>eigenvector</code>, <code>pagerank</code></li>
          <li><code>hub</code>, <code>authority</code></li>
        </ul>
      </div>

      <div>
        <h3>For filter_edges()</h3>
        <p><strong>Edge Columns:</strong></p>
        <ul>
          <li><code>from</code> - Source node index</li>
          <li><code>to</code> - Target node index</li>
          <li><code>weight</code> - Edge weight</li>
          <li>+ any custom edge attributes</li>
        </ul>

        <p><strong>Computed Values:</strong></p>
        <ul>
          <li><code>mean(weight)</code></li>
          <li><code>median(weight)</code></li>
          <li><code>quantile(weight, p)</code></li>
          <li><code>abs(weight)</code></li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Format Preservation -->
  <section class="section" id="keep-format">
    <h2>Format Preservation</h2>
    <p>
      By default, filter functions return <code>cograph_network</code> (the universal format).
      Use <code>keep_format = TRUE</code> to return the same format as input.
    </p>

    <table class="func-table">
      <thead>
        <tr>
          <th>Input</th>
          <th>Default Output</th>
          <th>keep_format = TRUE</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>matrix</code></td>
          <td>cograph_network</td>
          <td>matrix</td>
        </tr>
        <tr>
          <td><code>igraph</code></td>
          <td>cograph_network</td>
          <td>igraph</td>
        </tr>
        <tr>
          <td><code>network</code></td>
          <td>cograph_network</td>
          <td>network</td>
        </tr>
        <tr>
          <td><code>cograph_network</code></td>
          <td>cograph_network</td>
          <td>cograph_network</td>
        </tr>
        <tr>
          <td><code>tna</code></td>
          <td>cograph_network</td>
          <td>cograph_network*</td>
        </tr>
      </tbody>
    </table>
    <p><small>*TNA objects cannot be reconstructed, so they always return cograph_network</small></p>

    <h3>Examples</h3>
    <pre><span class="comment"># Default: returns cograph_network</span>
filter_edges(adj, weight > <span class="number">0.5</span>)
<span class="comment">#> cograph_network object</span>

<span class="comment"># Keep format: matrix in, matrix out</span>
filter_edges(adj, weight > <span class="number">0.5</span>, keep_format = TRUE)
<span class="comment">#> matrix</span>

<span class="comment"># igraph workflow</span>
g <- igraph::graph_from_adjacency_matrix(adj, weighted = TRUE)
filter_nodes(g, degree >= <span class="number">2</span>, keep_format = TRUE)
<span class="comment">#> igraph object</span></pre>

    <div class="info">
      <div class="info-title">Format Message</div>
      <p>When converting complex formats (igraph, network, qgraph), a helpful message is shown:</p>
      <pre style="background: #dbeafe; color: #1e40af; margin: 0.5rem 0;">Result converted to cograph_network. Use keep_format = TRUE to return igraph.</pre>
    </div>
  </section>

  <!-- Pipe Chaining -->
  <section class="section" id="chaining">
    <h2>Pipe Chaining</h2>
    <p>Filter functions are designed for pipe-friendly workflows:</p>

    <pre><span class="comment"># Chain multiple operations</span>
adj |>
  as_cograph() |>
  filter_edges(weight > <span class="number">0.3</span>) |>
  filter_nodes(degree >= <span class="number">2</span>) |>
  splot()

<span class="comment"># Complex pipeline</span>
network_data |>
  as_cograph() |>
  filter_edges(weight > mean(weight)) |>
  filter_nodes(pagerank > <span class="number">0.1</span>) |>
  filter_nodes(label != <span class="string">"excluded_node"</span>) |>
  splot(node_fill = color_communities(.))</pre>

    <div class="tip">
      <div class="tip-title">Best Practice</div>
      <p>
        For chaining, use the default <code>cograph_network</code> output.
        Only use <code>keep_format = TRUE</code> at the end of a pipeline if you need
        a specific format for downstream tools.
      </p>
    </div>
  </section>

  <!-- Complete Examples -->
  <section class="section" id="examples">
    <h2>Complete Examples</h2>

    <h3>Example 1: Social Network Analysis</h3>
    <pre><span class="comment"># Load network</span>
social_net <- as_cograph(social_matrix)

<span class="comment"># Find influential people (high PageRank, high betweenness)</span>
influencers <- filter_nodes(social_net,
  pagerank > quantile(pagerank, <span class="number">0.9</span>) |
  betweenness > quantile(betweenness, <span class="number">0.9</span>)
)
splot(influencers)

<span class="comment"># Strong connections only</span>
strong_ties <- filter_edges(social_net, weight >= <span class="number">0.7</span>)
splot(strong_ties)</pre>

    <h3>Example 2: TNA Backbone Extraction</h3>
    <pre><span class="comment"># Load TNA model</span>
net <- as_cograph(tna_model)

<span class="comment"># Keep only significant transitions</span>
backbone <- net |>
  filter_edges(weight > <span class="number">0.1</span>) |>
  filter_nodes(inits > <span class="number">0.05</span>)

splot(backbone)</pre>

    <h3>Example 3: Network Comparison</h3>
    <pre><span class="comment"># Compare networks by keeping only shared structure</span>
net1 <- as_cograph(matrix1)
net2 <- as_cograph(matrix2)

<span class="comment"># Extract cores (high-degree nodes)</span>
core1 <- filter_nodes(net1, degree >= <span class="number">3</span>)
core2 <- filter_nodes(net2, degree >= <span class="number">3</span>)

<span class="comment"># Plot comparison</span>
par(mfrow = c(<span class="number">1</span>, <span class="number">2</span>))
splot(core1)
splot(core2)</pre>

    <h3>Example 4: igraph Integration</h3>
    <pre><span class="comment"># Start with igraph</span>
g <- igraph::make_graph(<span class="string">"Zachary"</span>)

<span class="comment"># Filter in cograph, return to igraph</span>
g_filtered <- filter_nodes(g, degree >= <span class="number">4</span>, keep_format = TRUE)

<span class="comment"># Continue with igraph functions</span>
igraph::cluster_louvain(g_filtered)</pre>

    <h3>Example 5: Dynamic Thresholding</h3>
    <pre><span class="comment"># User-defined threshold</span>
threshold <- <span class="number">0.5</span>

<span class="comment"># Works with variables from parent environment</span>
filter_edges(adj, weight > threshold)

<span class="comment"># Percentile-based filtering</span>
top_pct <- <span class="number">0.1</span>  <span class="comment"># Top 10%</span>
filter_edges(adj, weight >= quantile(weight, <span class="number">1</span> - top_pct))</pre>
  </section>

</div>

</body>
</html>
