<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MCML Analysis - cograph</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 2rem;
        }
        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(90deg, #4ECDC4, #2E86AB, #A23B72);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .subtitle {
            text-align: center;
            color: #94a3b8;
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }
        .func-badges {
            text-align: center;
            margin-bottom: 2rem;
        }
        .func-badge {
            display: inline-block;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            margin: 0 0.5rem;
            font-family: monospace;
            font-size: 1rem;
        }
        .func-badge.summary { border-color: #4ECDC4; color: #4ECDC4; }
        .func-badge.tna { border-color: #2E86AB; color: #2E86AB; }
        .func-badge.plot { border-color: #A23B72; color: #A23B72; }
        .section {
            max-width: 1400px;
            margin: 0 auto 3rem;
        }
        .section h2 {
            color: #f1f5f9;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #334155;
        }
        .section p.desc {
            color: #94a3b8;
            margin-bottom: 1.5rem;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 1.5rem;
        }
        .grid-2 { grid-template-columns: repeat(2, 1fr); }
        .card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }
        .card img {
            width: 100%;
            display: block;
            background: #fff;
        }
        .card-content {
            padding: 1rem;
        }
        .card h3 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: #f1f5f9;
        }
        .card p {
            color: #94a3b8;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        .badge {
            display: inline-block;
            background: #7c3aed;
            color: #fff;
            padding: 0.2rem 0.6rem;
            border-radius: 15px;
            font-size: 0.75rem;
            margin-bottom: 0.5rem;
            font-family: monospace;
        }
        .badge.green { background: #059669; }
        .badge.blue { background: #2563eb; }
        .badge.orange { background: #d97706; }
        .badge.pink { background: #db2777; }
        .badge.cyan { background: #0891b2; }
        .code-block {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem auto 2rem;
            max-width: 1000px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
        }
        .code-block code {
            color: #22d3ee;
        }
        .code-comment { color: #64748b; }
        .code-string { color: #a5f3fc; }
        .code-param { color: #fbbf24; }
        .code-func { color: #4ade80; }
        .wide-card { grid-column: span 2; }
        .matrix-display {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: monospace;
            font-size: 0.8rem;
            overflow-x: auto;
        }
        .matrix-display table {
            border-collapse: collapse;
            margin: 0 auto;
        }
        .matrix-display th, .matrix-display td {
            padding: 0.5rem 1rem;
            text-align: right;
            border: 1px solid #334155;
        }
        .matrix-display th {
            background: #1e293b;
            color: #4ECDC4;
        }
        .matrix-display td { color: #f1f5f9; }
        .matrix-display .diag { background: rgba(78, 205, 196, 0.2); }
        @media (max-width: 900px) {
            .wide-card { grid-column: span 1; }
            .grid-2 { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <h1>MCML Analysis</h1>
    <p class="subtitle">Multi-Cluster Multi-Level Network Analysis</p>

    <div class="func-badges">
        <span class="func-badge summary">cluster_summary()</span>
        <span class="func-badge tna">as_tna()</span>
        <span class="func-badge plot">plot_mcml()</span>
    </div>

    <!-- Workflow -->
    <div class="section">
        <h2>Workflow</h2>
        <p class="desc">Aggregate node-level networks into cluster-level summaries. Create TNA models for transitions between and within clusters.</p>
        <div class="code-block">
            <code>
<span class="code-comment"># 1. Create network from edge list</span><br>
net <- <span class="code-func">cograph</span>(edges, <span class="code-param">nodes</span> = nodes)<br>
net$nodes$clusters <- nodes$cluster<br><br>

<span class="code-comment"># 2. Define clusters</span><br>
clusters <- <span class="code-func">split</span>(nodes$label, nodes$cluster)<br><br>

<span class="code-comment"># 3. Compute cluster summary (row-normalized)</span><br>
cs <- <span class="code-func">cluster_summary</span>(net, clusters, <span class="code-param">type</span> = <span class="code-string">"tna"</span>)<br><br>

<span class="code-comment"># 4. Convert to tna models</span><br>
tna_models <- <span class="code-func">as_tna</span>(cs)<br><br>

<span class="code-comment"># 5. Use tna models</span><br>
<span class="code-func">plot</span>(tna_models$between)        <span class="code-comment"># Between-cluster</span><br>
<span class="code-func">plot</span>(tna_models$within$Search)  <span class="code-comment"># Within-cluster</span>
            </code>
        </div>
    </div>

    <!-- Between-Cluster Matrix -->
    <div class="section">
        <h2>Between-Cluster Weights</h2>
        <p class="desc">Transition probabilities between clusters. Rows sum to 1. Diagonal = 0 (within-cluster data is in $within).</p>
        <div class="matrix-display">
            <table>
                <tr>
                    <th></th>
                    <th>Collaborate</th>
                    <th>Execute</th>
                    <th>Monitor</th>
                    <th>Plan</th>
                    <th>Review</th>
                    <th>Search</th>
                </tr>
                <tr>
                    <th>Collaborate</th>
                    <td class="diag">0</td>
                    <td>0.249</td>
                    <td>0.114</td>
                    <td>0.198</td>
                    <td>0.194</td>
                    <td>0.245</td>
                </tr>
                <tr>
                    <th>Execute</th>
                    <td>0.238</td>
                    <td class="diag">0</td>
                    <td>0.134</td>
                    <td>0.191</td>
                    <td>0.213</td>
                    <td>0.224</td>
                </tr>
                <tr>
                    <th>Monitor</th>
                    <td>0.192</td>
                    <td>0.217</td>
                    <td class="diag">0</td>
                    <td>0.203</td>
                    <td>0.147</td>
                    <td>0.241</td>
                </tr>
                <tr>
                    <th>Plan</th>
                    <td>0.230</td>
                    <td>0.217</td>
                    <td>0.108</td>
                    <td class="diag">0</td>
                    <td>0.188</td>
                    <td>0.257</td>
                </tr>
                <tr>
                    <th>Review</th>
                    <td>0.191</td>
                    <td>0.238</td>
                    <td>0.114</td>
                    <td>0.212</td>
                    <td class="diag">0</td>
                    <td>0.245</td>
                </tr>
                <tr>
                    <th>Search</th>
                    <td>0.249</td>
                    <td>0.213</td>
                    <td>0.127</td>
                    <td>0.221</td>
                    <td>0.190</td>
                    <td class="diag">0</td>
                </tr>
            </table>
        </div>
        <div class="code-block">
            <code>
<span class="code-comment"># Access between-cluster weights</span><br>
cs$between$weights<br><br>

<span class="code-comment"># Access initial distribution</span><br>
cs$between$inits
            </code>
        </div>
    </div>

    <!-- Visualizations -->
    <div class="section">
        <h2>Visualizations</h2>
        <p class="desc">TNA models for between-cluster and within-cluster transitions.</p>
        <div class="grid grid-2">
            <div class="card">
                <img src="mcml_between.png" alt="Between-cluster TNA">
                <div class="card-content">
                    <span class="badge green">tna_models$between</span>
                    <h3>Between-Cluster TNA</h3>
                    <p>6 clusters as nodes. Edge weights = transition probabilities between clusters.</p>
                </div>
            </div>
            <div class="card">
                <img src="mcml_within.png" alt="Within-cluster TNAs">
                <div class="card-content">
                    <span class="badge blue">tna_models$within</span>
                    <h3>Within-Cluster TNAs</h3>
                    <p>Internal transition networks for each cluster. Each cluster's nodes and their internal connections.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- MCML Plot -->
    <div class="section">
        <h2>plot_mcml() - Two-Layer Visualization</h2>
        <p class="desc">Summary network on top, detailed clusters below. Connects cluster-level to node-level.</p>
        <div class="card" style="max-width: 1000px; margin: 0 auto;">
            <img src="mcml_full.png" alt="MCML visualization">
            <div class="card-content">
                <span class="badge pink">plot_mcml(cs)</span>
                <h3>Multi-Level View</h3>
                <p>Top layer: cluster-to-cluster transitions. Bottom layer: node-level networks within each cluster.</p>
            </div>
        </div>
        <div class="code-block">
            <code>
<span class="code-func">plot_mcml</span>(cs,<br>
&nbsp;&nbsp;<span class="code-param">title</span> = <span class="code-string">"Learning Process"</span>,<br>
&nbsp;&nbsp;<span class="code-param">edge_labels</span> = TRUE,<br>
&nbsp;&nbsp;<span class="code-param">edge_label_digits</span> = 2<br>
)
            </code>
        </div>
    </div>

    <!-- Access Structure -->
    <div class="section">
        <h2>Data Access</h2>
        <p class="desc">Access computed weights and tna models.</p>
        <div class="code-block">
            <code>
<span class="code-comment"># cluster_summary structure</span><br>
cs$between$weights      <span class="code-comment"># k×k cluster transition matrix</span><br>
cs$between$inits        <span class="code-comment"># Initial distribution (k-length)</span><br>
cs$within$Search$weights  <span class="code-comment"># Node transitions within Search cluster</span><br>
cs$within$Search$inits    <span class="code-comment"># Initial distribution within Search</span><br>
cs$clusters             <span class="code-comment"># Named list of node labels per cluster</span><br>
cs$meta                 <span class="code-comment"># Metadata: type, method, n_nodes, n_clusters</span><br><br>

<span class="code-comment"># as_tna() structure</span><br>
tna_models$between      <span class="code-comment"># tna object for between-cluster</span><br>
tna_models$within$Search  <span class="code-comment"># tna object for Search cluster</span><br><br>

<span class="code-comment"># Use with tna package</span><br>
tna::<span class="code-func">centrality</span>(tna_models$between)<br>
tna::<span class="code-func">bootstrap</span>(tna_models$within$Execute)
            </code>
        </div>
    </div>

    <!-- cluster_summary() Parameters -->
    <div class="section">
        <h2>cluster_summary() Parameters</h2>
        <p class="desc">Aggregates node-level network weights to cluster-level summaries.</p>

        <h3 style="color: #4ECDC4; margin: 1.5rem 0 1rem;">x - Network Input</h3>
        <div class="grid grid-2">
            <div class="card">
                <div class="card-content">
                    <span class="badge blue">matrix</span>
                    <h3>Adjacency Matrix</h3>
                    <p>Numeric matrix with row/column names as node labels. Values are edge weights (counts, frequencies, or probabilities).</p>
                </div>
            </div>
            <div class="card">
                <div class="card-content">
                    <span class="badge green">cograph_network</span>
                    <h3>Cograph Object</h3>
                    <p>Extracts weights from <code>x$weights</code>. Clusters can be auto-detected from <code>x$nodes$clusters</code>.</p>
                </div>
            </div>
            <div class="card">
                <div class="card-content">
                    <span class="badge cyan">tna</span>
                    <h3>TNA Object</h3>
                    <p>Extracts weights from <code>x$weights</code>. Use when you already have a tna model.</p>
                </div>
            </div>
            <div class="card">
                <div class="card-content">
                    <span class="badge">cluster_summary</span>
                    <h3>Existing Summary</h3>
                    <p>Returns unchanged. Allows passing pre-computed summaries to plotting functions.</p>
                </div>
            </div>
        </div>

        <h3 style="color: #4ECDC4; margin: 1.5rem 0 1rem;">clusters - Cluster Assignments</h3>
        <div class="grid">
            <div class="card">
                <div class="card-content">
                    <span class="badge green">NULL (default)</span>
                    <h3>Auto-Detect</h3>
                    <p>Only works with cograph_network. Looks for columns named 'clusters', 'cluster', 'groups', or 'group' in <code>x$nodes</code>.</p>
                </div>
            </div>
            <div class="card">
                <div class="card-content">
                    <span class="badge blue">vector</span>
                    <h3>Membership Vector</h3>
                    <p>Cluster ID per node, same order as matrix rows. Example: <code>c(1, 1, 2, 2, 3, 3)</code> or <code>c("A", "A", "B", "B")</code></p>
                </div>
            </div>
            <div class="card">
                <div class="card-content">
                    <span class="badge orange">named list</span>
                    <h3>Explicit Mapping</h3>
                    <p>Cluster name → node labels. Example: <code>list(Alpha = c("n1", "n2"), Beta = c("n3", "n4"))</code></p>
                </div>
            </div>
        </div>

        <h3 style="color: #4ECDC4; margin: 1.5rem 0 1rem;">method - Aggregation Method</h3>
        <p class="desc">How to combine edge weights when aggregating nodes into clusters.</p>
        <div class="grid grid-2">
            <div class="card">
                <div class="card-content">
                    <span class="badge green">method = "sum"</span>
                    <h3>Sum (Default)</h3>
                    <p>Total of all edge weights. Best for <strong>count data</strong> (transition frequencies). Preserves total flow. Larger clusters contribute more weight.</p>
                </div>
            </div>
            <div class="card">
                <div class="card-content">
                    <span class="badge blue">method = "mean"</span>
                    <h3>Mean</h3>
                    <p>Average edge weight. Best when <strong>cluster sizes differ</strong> and you want to control for size. Recommended when input is already a transition matrix.</p>
                </div>
            </div>
            <div class="card">
                <div class="card-content">
                    <span class="badge">method = "max"</span>
                    <h3>Maximum</h3>
                    <p>Strongest connection only. Captures the <strong>dominant pathway</strong> between clusters.</p>
                </div>
            </div>
            <div class="card">
                <div class="card-content">
                    <span class="badge">method = "density"</span>
                    <h3>Density</h3>
                    <p>Sum divided by number of possible edges. <strong>Normalizes by cluster size</strong> combinations.</p>
                </div>
            </div>
        </div>
        <div class="code-block">
            <code>
<span class="code-comment"># When to use which method:</span><br><br>
<span class="code-comment"># Edge counts (raw frequencies) → use "sum"</span><br>
cs <- <span class="code-func">cluster_summary</span>(counts, clusters, <span class="code-param">method</span> = <span class="code-string">"sum"</span>)<br><br>

<span class="code-comment"># Transition matrix (already normalized) → use "mean" to avoid size bias</span><br>
cs <- <span class="code-func">cluster_summary</span>(tna_weights, clusters, <span class="code-param">method</span> = <span class="code-string">"mean"</span>)<br><br>

<span class="code-comment"># Find strongest pathway → use "max"</span><br>
cs <- <span class="code-func">cluster_summary</span>(mat, clusters, <span class="code-param">method</span> = <span class="code-string">"max"</span>)
            </code>
        </div>

        <h3 style="color: #4ECDC4; margin: 1.5rem 0 1rem;">type - Output Processing</h3>
        <p class="desc">How to process the aggregated weights.</p>
        <div class="grid grid-2">
            <div class="card">
                <div class="card-content">
                    <span class="badge green">type = "tna"</span>
                    <h3>Row-Normalized (Default)</h3>
                    <p>Each row sums to 1. Creates <strong>transition probabilities</strong>. Required for tna package, Markov analysis, centrality measures. Diagonal = within-cluster retention rate.</p>
                </div>
            </div>
            <div class="card">
                <div class="card-content">
                    <span class="badge orange">type = "raw"</span>
                    <h3>Raw Counts</h3>
                    <p>No normalization. Returns <strong>aggregated weights as-is</strong>. Use for frequency analysis. Compatible with igraph's contract + simplify.</p>
                </div>
            </div>
            <div class="card">
                <div class="card-content">
                    <span class="badge">type = "cooccurrence"</span>
                    <h3>Symmetric</h3>
                    <p>Symmetrizes: (A + A') / 2. For <strong>undirected co-occurrence</strong> analysis where direction doesn't matter.</p>
                </div>
            </div>
            <div class="card">
                <div class="card-content">
                    <span class="badge">type = "semi_markov"</span>
                    <h3>Semi-Markov</h3>
                    <p>Row-normalized with duration weighting. For <strong>semi-Markov process</strong> analysis.</p>
                </div>
            </div>
        </div>

        <h3 style="color: #4ECDC4; margin: 1.5rem 0 1rem;">Other Parameters</h3>
        <div class="grid grid-2">
            <div class="card">
                <div class="card-content">
                    <span class="badge blue">directed = TRUE</span>
                    <h3>Directed Network</h3>
                    <p>Default. A→B and B→A are separate edges. Set to FALSE for undirected networks (matrix is symmetrized).</p>
                </div>
            </div>
            <div class="card">
                <div class="card-content">
                    <span class="badge">compute_within = TRUE</span>
                    <h3>Within-Cluster Matrices</h3>
                    <p>Default. Computes internal transitions for each cluster. Set to FALSE for speed when only between-cluster summary needed.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- as_tna() Parameters -->
    <div class="section">
        <h2>as_tna() Parameters</h2>
        <p class="desc">Converts cluster_summary to proper tna objects for use with the tna package.</p>

        <div class="code-block">
            <code>
<span class="code-comment"># Input</span><br>
<span class="code-func">as_tna</span>(x)  <span class="code-comment"># x must be a cluster_summary object</span><br><br>

<span class="code-comment"># Recommended: create with type = "tna" for proper probabilities</span><br>
cs <- <span class="code-func">cluster_summary</span>(net, clusters, <span class="code-param">type</span> = <span class="code-string">"tna"</span>)<br>
tna_models <- <span class="code-func">as_tna</span>(cs)
            </code>
        </div>

        <h3 style="color: #2E86AB; margin: 1.5rem 0 1rem;">Return Value</h3>
        <div class="grid grid-2">
            <div class="card">
                <div class="card-content">
                    <span class="badge green">$between</span>
                    <h3>Between-Cluster TNA</h3>
                    <p>A tna object for cluster-level transitions. Contains <code>$weights</code> (k×k matrix), <code>$inits</code> (initial distribution), <code>$labels</code> (cluster names). Use for analyzing movement between groups.</p>
                </div>
            </div>
            <div class="card">
                <div class="card-content">
                    <span class="badge blue">$within</span>
                    <h3>Within-Cluster TNAs</h3>
                    <p>Named list of tna objects, one per cluster. Each has <code>$weights</code>, <code>$inits</code>, <code>$labels</code>. Use for detailed analysis within each group. Single-node clusters are excluded.</p>
                </div>
            </div>
        </div>

        <div class="code-block">
            <code>
<span class="code-comment"># Access components</span><br>
tna_models$between              <span class="code-comment"># Between-cluster tna object</span><br>
tna_models$between$weights      <span class="code-comment"># k×k transition matrix</span><br>
tna_models$between$inits        <span class="code-comment"># Initial distribution</span><br>
tna_models$between$labels       <span class="code-comment"># Cluster names</span><br><br>

tna_models$within               <span class="code-comment"># Named list of within-cluster tnas</span><br>
tna_models$within$Search        <span class="code-comment"># tna for "Search" cluster</span><br>
tna_models$within$Search$weights  <span class="code-comment"># Internal transitions</span><br><br>

<span class="code-comment"># Use with tna package</span><br>
<span class="code-func">plot</span>(tna_models$between)<br>
tna::<span class="code-func">centrality</span>(tna_models$between)<br>
tna::<span class="code-func">bootstrap</span>(tna_models$between, <span class="code-param">R</span> = 1000)<br><br>

<span class="code-comment"># Compare clusters</span><br>
tna::<span class="code-func">centrality</span>(tna_models$within$Search)<br>
tna::<span class="code-func">centrality</span>(tna_models$within$Execute)
            </code>
        </div>
    </div>

    <!-- plot_mcml() Parameters -->
    <div class="section">
        <h2>plot_mcml() Parameters</h2>
        <p class="desc">Two-layer 3D visualization with summary network on top, detailed clusters below.</p>

        <div class="code-block">
            <code>
<span class="code-func">plot_mcml</span>(<br>
&nbsp;&nbsp;x,                              <span class="code-comment"># cluster_summary, matrix, cograph, or tna</span><br>
&nbsp;&nbsp;<span class="code-param">clusters</span> = NULL,               <span class="code-comment"># Required if x is matrix (not cluster_summary)</span><br>
&nbsp;&nbsp;<span class="code-param">type</span> = <span class="code-string">"tna"</span>,                  <span class="code-comment"># Passed to cluster_summary if x is not already one</span><br>
&nbsp;&nbsp;<span class="code-param">method</span> = <span class="code-string">"sum"</span>,                <span class="code-comment"># Passed to cluster_summary if x is not already one</span><br>
&nbsp;&nbsp;<span class="code-param">title</span> = NULL,                  <span class="code-comment"># Plot title</span><br>
&nbsp;&nbsp;<span class="code-param">edge_labels</span> = FALSE,           <span class="code-comment"># Show edge weight labels?</span><br>
&nbsp;&nbsp;<span class="code-param">edge_label_digits</span> = 2,        <span class="code-comment"># Decimal places for labels</span><br>
&nbsp;&nbsp;<span class="code-param">summary_edge_labels</span> = TRUE,   <span class="code-comment"># Labels on top (summary) layer?</span><br>
&nbsp;&nbsp;<span class="code-param">layer_spacing</span> = 6,             <span class="code-comment"># Vertical gap between layers</span><br>
&nbsp;&nbsp;<span class="code-param">skew_angle</span> = 0.4,              <span class="code-comment"># 3D perspective angle (0-1)</span><br>
&nbsp;&nbsp;<span class="code-param">node_size</span> = 6,                 <span class="code-comment"># Size of nodes</span><br>
&nbsp;&nbsp;<span class="code-param">summary_node_size</span> = 10,       <span class="code-comment"># Size of summary (cluster) nodes</span><br>
&nbsp;&nbsp;<span class="code-param">edge_width</span> = 1,                <span class="code-comment"># Edge line width</span><br>
&nbsp;&nbsp;<span class="code-param">summary_edge_width</span> = 2,       <span class="code-comment"># Summary edge line width</span><br>
&nbsp;&nbsp;<span class="code-param">minimum</span> = 0,                   <span class="code-comment"># Hide edges below this weight</span><br>
&nbsp;&nbsp;<span class="code-param">colors</span> = NULL                  <span class="code-comment"># Named vector of cluster colors</span><br>
)
            </code>
        </div>
    </div>

    <!-- Return Structure -->
    <div class="section">
        <h2>cluster_summary Return Structure</h2>
        <p class="desc">Complete structure of the cluster_summary object.</p>
        <div class="code-block">
            <code>
<span class="code-comment"># cluster_summary object structure</span><br>
cs <- <span class="code-func">cluster_summary</span>(net, clusters, <span class="code-param">type</span> = <span class="code-string">"tna"</span>)<br><br>

cs$between$weights      <span class="code-comment"># k×k matrix: cluster-to-cluster transitions</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment"># Diagonal = within-cluster totals (self-loops)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment"># If type="tna", rows sum to 1</span><br><br>

cs$between$inits        <span class="code-comment"># k-length vector: initial distribution across clusters</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment"># Proportion of incoming edges to each cluster</span><br><br>

cs$within$ClusterA$weights  <span class="code-comment"># n_i × n_i matrix: internal transitions in ClusterA</span><br>
cs$within$ClusterA$inits    <span class="code-comment"># n_i-length: initial distribution within cluster</span><br><br>

cs$clusters             <span class="code-comment"># Named list: cluster name → node labels</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment"># list(Search = c("S1", "S2"), Plan = c("P1", "P2"))</span><br><br>

cs$meta$type            <span class="code-comment"># "tna", "raw", "cooccurrence", or "semi_markov"</span><br>
cs$meta$method          <span class="code-comment"># "sum", "mean", "max", etc.</span><br>
cs$meta$directed        <span class="code-comment"># TRUE/FALSE</span><br>
cs$meta$n_nodes         <span class="code-comment"># Total nodes in original network</span><br>
cs$meta$n_clusters      <span class="code-comment"># Number of clusters</span><br>
cs$meta$cluster_sizes   <span class="code-comment"># Named vector: nodes per cluster</span>
            </code>
        </div>
    </div>

    <!-- Choosing Parameters -->
    <div class="section">
        <h2>Choosing method and type</h2>
        <p class="desc">Recommendations based on your input data.</p>
        <div class="matrix-display">
            <table>
                <tr>
                    <th>Input Data</th>
                    <th>method</th>
                    <th>type</th>
                    <th>Reason</th>
                </tr>
                <tr>
                    <td>Edge counts (frequencies)</td>
                    <td><code>"sum"</code></td>
                    <td><code>"tna"</code></td>
                    <td style="text-align: left;">Preserves total flow, normalizes to probabilities</td>
                </tr>
                <tr>
                    <td>Transition matrix (TNA)</td>
                    <td><code>"mean"</code></td>
                    <td><code>"tna"</code></td>
                    <td style="text-align: left;">Avoids cluster size bias (sum would weight larger clusters more)</td>
                </tr>
                <tr>
                    <td>Raw frequencies for analysis</td>
                    <td><code>"sum"</code></td>
                    <td><code>"raw"</code></td>
                    <td style="text-align: left;">Keep raw counts without normalization</td>
                </tr>
                <tr>
                    <td>Correlation matrix</td>
                    <td><code>"mean"</code></td>
                    <td><code>"raw"</code></td>
                    <td style="text-align: left;">Average correlations, don't normalize rows</td>
                </tr>
                <tr>
                    <td>Find dominant pathway</td>
                    <td><code>"max"</code></td>
                    <td><code>"tna"</code></td>
                    <td style="text-align: left;">Strongest connection only</td>
                </tr>
            </table>
        </div>
    </div>

</body>
</html>
